<view class="mp-page mp-detail">
  <view class="mp-page__bd">
    <view wx:if="{{error}}" class="weui-msg mp-detail__msg">
      <view class="weui-msg__text-area">
        <view class="weui-msg__title">加载失败</view>
        <view class="weui-msg__desc">{{error}}</view>
      </view>
      <view class="weui-msg__opr-area">
        <view class="weui-btn-area">
          <navigator class="weui-btn weui-btn_primary" open-type="navigateBack" delta="1">返回</navigator>
        </view>
      </view>
    </view>

    <view wx:elif="{{loading}}" class="weui-loadmore">
      <view class="weui-loading"></view>
      <view class="weui-loadmore__tips">加载中</view>
    </view>

    <block wx:else>
      <view class="mp-detail__hero mp-card" wx:if="{{coffeeBean}}">
        <view class="mp-detail__name">{{coffeeBean.name}}</view>
        <view class="mp-detail__meta">
          <text>{{coffeeBean.country}}</text>
          <text class="mp-dot">·</text>
          <text>{{coffeeBean.flavor_category}}</text>
          <text wx:if="{{coffeeBean.origin}}" class="mp-dot">·</text>
          <text wx:if="{{coffeeBean.origin}}">{{coffeeBean.origin}}</text>
        </view>
        <view class="mp-detail__priceRow">
          <view class="mp-detail__price">{{coffeeBean.price_per_kg ? ('¥ ' + coffeeBean.price_per_kg) : '暂无价格'}}</view>
          <text class="mp-tag {{coffeeBean.type === 'premium' ? 'mp-tag--premium' : 'mp-tag--common'}}">{{coffeeBean.type === 'premium' ? '精品' : '商业'}}</text>
          <text class="mp-tag {{coffeeBean.sold_out ? 'mp-tag--soldout' : 'mp-tag--instock'}}">{{coffeeBean.sold_out ? '售罄' : '有货'}}</text>
        </view>
      </view>

      <view class="weui-cells__title" wx:if="{{coffeeBean}}">基础信息</view>
      <view class="weui-cells mp-card mp-detail__cells" wx:if="{{coffeeBean}}">
        <view class="weui-cell">
          <view class="weui-cell__bd">等级</view>
          <view class="weui-cell__ft">{{coffeeBean.grade || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">密度</view>
          <view class="weui-cell__ft">{{coffeeBean.density || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">海拔</view>
          <view class="weui-cell__ft">{{coffeeBean.altitude || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">风味</view>
          <view class="weui-cell__ft">{{coffeeBean.flavor_profile || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">加工方式</view>
          <view class="weui-cell__ft">{{coffeeBean.processing_method || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">品种</view>
          <view class="weui-cell__ft">{{coffeeBean.variety || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">供应商</view>
          <view class="weui-cell__ft">{{coffeeBean.provider || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">收获季节</view>
          <view class="weui-cell__ft">{{coffeeBean.harvest_season || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">地块</view>
          <view class="weui-cell__ft">{{coffeeBean.plot || '—'}}</view>
        </view>
        <view class="weui-cell">
          <view class="weui-cell__bd">庄园</view>
          <view class="weui-cell__ft">{{coffeeBean.estate || '—'}}</view>
        </view>
      </view>

      <view class="weui-cells__title" wx:if="{{priceTrends.length > 0}}">价格趋势</view>
      <view class="weui-cells mp-card mp-detail__cells" wx:if="{{priceTrends.length > 0}}">
        <view wx:for="{{priceTrends}}" wx:key="index" class="weui-cell">
          <view class="weui-cell__bd">{{item.data_year}}-{{item.data_month}}</view>
          <view class="weui-cell__ft">{{item.price_per_kg}} 元/kg</view>
        </view>
      </view>

      <view class="weui-tips" wx:if="{{priceTrends.length === 0}}">暂无价格趋势数据</view>
    </block>
  </view>

  <view class="mp-detail__bottom" wx:if="{{!loading && !error && coffeeBean}}">
    <button class="weui-btn weui-btn_primary mp-detail__primaryBtn" disabled="{{coffeeBean.sold_out}}">{{coffeeBean.sold_out ? '已售罄' : '加入购物车'}}</button>
    <navigator class="weui-btn weui-btn_default mp-detail__secondaryBtn" open-type="navigateBack" delta="1">返回</navigator>
  </view>
</view>
